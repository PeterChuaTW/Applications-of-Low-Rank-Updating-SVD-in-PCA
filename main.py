"""\nMain script demonstrating Incremental PCA using Brand's algorithm.\n\nThis script:\n1. Loads the ORL Face Database (or generates synthetic data)\n2. Compares Incremental PCA vs Batch PCA\n3. Evaluates reconstruction error\n4. Benchmarks performance\n"""\nimport numpy as np\nimport sys\nimport os\n\n# Add src directory to path\nsys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))\n\nfrom incremental_pca import IncrementalPCA\nfrom batch_pca import BatchPCA\nfrom data_loader import load_orl_faces, normalize_faces\nfrom utils import (\n    compare_pca_methods, \n    print_comparison_results,\n    reconstruction_error,\n    normalized_reconstruction_error\n)\n\n\ndef main():\n    """Main execution function."""\n    \n    print("="*60)\n    print("Incremental PCA using Brand's Algorithm")\n    print("ORL Face Database Analysis")\n    print("="*60)\n    \n    # Load data - FIXED: handle 3 return values\n    print("\\n1. Loading ORL Face Database...")\n    faces, labels, is_real = load_orl_faces('data/ORL_Faces')\n    \n    if not is_real:\n        print("   ⚠️  WARNING: Using synthetic data for demonstration")\n        print("   Please download ORL Database manually if needed")\n    else:\n        print("   ✅ Using REAL ORL Face Database")\n    \n    print(f"   Dataset shape: {faces.shape}")\n    print(f"   Number of samples: {faces.shape[0]}")\n    print(f"   Features per sample: {faces.shape[1]} (92x112 pixels)")\n    \n    # Normalize data (Mean Centering - REQUIRED for PCA)\n    print("\\n2. Preprocessing: Mean Centering...")\n    centered_faces, mean_face = normalize_faces(faces)\n    \n    # Set parameters\n    n_components = 50  # Number of principal components\n    batch_size = 10    # Batch size for incremental PCA\n    \n    print(f"\\n3. Configuration:")\n    print(f"   Number of components: {n_components}")\n    print(f"   Batch size for incremental PCA: {batch_size}")\n    \n    # Initialize PCA models\n    print("\\n4. Initializing PCA models...")\n    inc_pca = IncrementalPCA(n_components=n_components)\n    batch_pca = BatchPCA(n_components=n_components)\n    \n    # Compare methods - FIXED: use centered_faces\n    print("\\n5. Comparing PCA methods...")\n    results = compare_pca_methods(\n        X=centered_faces,\n        n_components=n_components,\n        batch_size=batch_size,\n        incremental_pca=inc_pca,\n        batch_pca=batch_pca\n    )\n    \n    # Print results\n    print_comparison_results(results)\n    \n    # Additional analysis\n    print("\\n6. Additional Analysis:")\n    \n    # Explained variance\n    inc_variance_ratio = inc_pca.get_explained_variance_ratio()\n    batch_variance_ratio = batch_pca.explained_variance_ratio_\n    \n    print(f"\\n   Explained variance by first 10 components:")\n    print(f"   Incremental PCA: {np.sum(inc_variance_ratio[:10]):.4f}")\n    print(f"   Batch PCA: {np.sum(batch_variance_ratio[:10]):.4f}")\n    \n    print(f"\\n   Total explained variance ({n_components} components):")\n    print(f"   Incremental PCA: {np.sum(inc_variance_ratio):.4f}")\n    print(f"   Batch PCA: {np.sum(batch_variance_ratio):.4f}")\n    \n    # Component similarity\n    inc_components = inc_pca.get_components()\n    batch_components = batch_pca.components_\n    \n    # Calculate similarity of first few components\n    n_compare = min(5, n_components)\n    print(f"\\n   Component similarity (first {n_compare} components):")\n    for i in range(n_compare):\n        # Cosine similarity (components might differ in sign)\n        similarity = abs(np.dot(inc_components[i], batch_components[i]))\n        similarity /= (np.linalg.norm(inc_components[i]) * np.linalg.norm(batch_components[i]))\n        print(f"   Component {i+1}: {similarity:.6f}")\n    \n    print("\\n" + "="*60)\n    print("Analysis Complete!")\n    print("="*60)\n    \n    return results\n\n\nif __name__ == "__main__":\n    try:\n        results = main()\n    except KeyboardInterrupt:\n        print("\\n\\nInterrupted by user.")\n        sys.exit(0)\n    except Exception as e:\n        print(f"\\nError: {e}")\n        import traceback\n        traceback.print_exc()\n        sys.exit(1)\n